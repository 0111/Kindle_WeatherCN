<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
</head>
    <script>
        function getNISTTimestamp() {
            // 使用 XMLHttpRequest 代替 fetch
            const xhr = new XMLHttpRequest();
            
            // 配置请求为同步请求（第三个参数设为 false）
            xhr.open('GET', 'https://time.gov/widget/dhtml/at_nist_use_only.cgi', false);
            
            try {
              // 发送同步请求
              xhr.send();
              
              // 因为是同步请求，代码会在这里等待，直到请求完成
              
              if (xhr.status === 200) { // 请求成功
                const responseText = xhr.responseText;
                
                // 使用正则表达式提取 time 值
                const timeMatch = responseText.match(/time="(\d+)"/);
                
                if (timeMatch && timeMatch[1]) {
                  const timeValue = timeMatch[1];
                  console.log('提取的时间戳:', timeValue);
                  
                  // 将时间戳转换为可读格式
                  const date = new Date(parseInt(timeValue) / 1000);
                  console.log('格式化时间:', date.toLocaleString());
                  
                  return timeValue;
                } else {
                  console.error('无法从响应中提取时间戳');
                  return null;
                }
              } else {
                console.error('请求失败。状态码:', xhr.status);
                return null;
              }
            } catch (error) {
              console.error('发送请求时出错:', error);
              
              // 处理可能的跨域问题提示
              if (error.message.includes('CORS') || error.message.includes('blocked')) {
                console.error('注意: 由于浏览器的同源策略，直接从前端调用此API可能会受到CORS限制。');
              }
              
              return null;
            }
          }
          
          // 调用函数，并可以直接获取返回值
          const timestamp = getNISTTimestamp();
          if (timestamp) {
            console.log('返回的时间戳:', timestamp);
          }
    </script>
<body>
    <h1>获取 NIST 时间戳</h1>
    <p>请查看控制台以获取提取的时间戳。</p>
</body>
</html>